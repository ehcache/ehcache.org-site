<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <link rel="shortcut icon"  type="image/x-icon" href="/images/favicon.ico">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

  <title>Ehcache</title>

  <meta name="description" content="Java's most widely used cache.">

  <link rel="canonical" href="https://www.ehcache.org/documentation/2.8/configuration/data-life.html">
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ehcache Feed">


  <!-- Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

  <!-- Global CSS -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/spacelab/bootstrap.min.css">


<!--
  <link rel="stylesheet" href="/plugins/highlight/styles/idea.css">
  <script src="/plugins/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
-->

  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/prettify.css"></script>

  <link rel="stylesheet" href="/css/main.css">

<!--
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
  <script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  
    <script>
    
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-131151-10', 'auto');
    ga('send', 'pageview');


    </script>
  
</head>


  <body>

    

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="site-title" href="/"><img src="/images/ehcache.png" style="margin-top:15px;margin-bottom:6px;"/></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="ehc_mnu_about"><a href="/about/"><i class="fa fa-info-circle"></i> About</a></li>
            <li id="ehc_mnu_docs"><a href="/documentation/"><i class="fa fa-book"></i> Docs</a></li>
            <li id="ehc_mnu_download"><a href="/downloads/"><i class="fa fa-download"></i> Download</a></li>
            <li id="ehc_mnu_community" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-users"></i> Community <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="dropdown-header">We Love Contributors</li>
                <li><a href="/community/contribute.html"><i class="fa fa-code"></i> Contributing</a></li>
                <!--
                <li><a href="/resources/"><i class="fa fa-external-link-square"></i> External Resources</a></li>
                <li><a href="http://blog.terracotta.org" target="_blank"><i class="fa fa-rss-square"></i> Terracotta Blog</a></li>
                -->
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Forums</li>
                <li><a href="https://groups.google.com/forum/#!forum/ehcache-users" target="_blank"><i class="fa fa-commenting"></i> Users' Forum</a></li>
                <li><a href="https://groups.google.com/forum/#!forum/ehcache-dev" target="_blank"><i class="fa fa-commenting"></i> Developers' Forum</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Source Code</li>
                <li><a href="https://github.com/ehcache/ehcache3" target="_blank"><i class="fa fa-github"></i> GitHub  (Ehcache 3)</a></li>
                <li><a href="http://svn.terracotta.org/svn/ehcache/trunk" target="_blank"><i class="fa fa-code-fork"></i> SVN  (Ehcache 2)</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Bug Tracking</li>
                <li><a href="https://github.com/ehcache/ehcache3/issues" target="_blank"><i class="fa fa-bug"></i> GitHub  (Ehcache 3)</a></li>
                <li><a href="https://jira.terracotta.org/jira/browse/EHC" target="_blank"><i class="fa fa-bug"></i> Jira  (Ehcache 2)</a></li>
              </ul>
            </li>
          </ul>
          <!--
          <ul class="nav navbar-nav navbar-right">
            <li id="ehc_mnu_events"><a href="/events"><i class="fa fa-calendar"></i> News & Events</a></li>
            <li><a href="/blog"><i class="fa fa-rss-square"></i> Ehcache Blog</a></li>
          </ul>
          -->
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<br/>
<br/>
<br/>


    <div class="container-fluid">
      <div id="contentTitle">
        <h1></h1>
      </div>
      <div>
        <br/>

<div class="container-fluid">

  <div class="row row-offcanvas row-offcanvas-left">

    <!-- sidebar -->
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
        <ul class="nav">
          <li class="submenu"><a href="/documentation/2.8/index.html">Docs Overview</a></li>
          <li class="submenu"><a href="/documentation/2.8/get-started/index.html">Getting Started</a></li>
          <li class="submenu"><a href="/documentation/2.8/configuration/index.html">Configuration</a></li>
          <li class="submenu"><a href="/documentation/2.8/bigmemory/index.html">BigMemory</a></li>
          <li class="submenu"><a href="/documentation/2.8/arc/index.html">Auto Resource Control (ARC)</a></li>
          <li class="submenu"><a href="/documentation/2.8/apis/index.html">APIs</a></li>
          <li class="submenu"><a href="/documentation/2.8/operations/index.html">Operations</a></li>
          <li class="submenu"><a href="/documentation/2.8/replication/index.html">Replication</a></li>
          <li class="submenu"><a href="/documentation/2.8/modules/index.html">Modules</a></li>
          <li class="submenu"><a href="/documentation/2.8/integrations/index.html">Integrations</a></li>
          <li class="submenu"><a href="/documentation/2.8/recipes/index.html">Recipes</a></li>
          <li class="submenu"><a href="/documentation/2.8/code-samples.html">Code Samples</a></li>
          <li class="submenu"><a href="/documentation/2.8/faq.html">FAQ</a></li>
          <li class="submenu"><a href="/apidocs/2.8.5/index.html" target="_blank">JavaDoc</a></li>
        </ul>
    </div>

    <!-- main area -->

    <div class="col-xs-12 col-sm-9">
      <header class="post-header">
        
        <h1 class="post-title"></h1>
        <hr/>
        
      </header>
      <article class="post-content">
        <h1 id="pinning-expiration-and-eviction">Pinning, Expiration, and Eviction</h1><div id="toc-container">
   <table class="toc" id="toc">
      <tbody>
         <tr>
            <td>
               <ul>
                  <li class="toc_level-1 toc_section-1">
                     <a href="#pinning-expiration-and-eviction">
                        <span class="toctext">Pinning, Expiration, and Eviction</span>
                     </a>
                     <ul>
                        <li class="toc_level-2 toc_section-2">
                           <a href="#introduction">
                              <span class="toctext">Introduction</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-3">
                           <a href="#setting-expiration-">
                              <span class="toctext">Setting Expiration </span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-4">
                           <a href="#pinning-data">
                              <span class="toctext">Pinning Data</span>
                           </a>
                        </li>
                        <li class="toc_level-2 toc_section-5">
                           <a href="#how-configuration-affects-element-flushing-and-eviction-">
                              <span class="toctext">How Configuration Affects Element Flushing and Eviction </span>
                           </a>
                        </li>
                     </ul>
                  </li>
               </ul>
            </td>
         </tr>
      </tbody>
   </table>
</div>

<h2 id="introduction">Introduction</h2>
<p>The architecture of an Ehcache node can include a number of tiers that store data. One of the most important aspects of managing cached data involves managing the life of those data in those tiers.</p>

<p>
   <img style="float:right" src="/images/documentation/data-life-elements.png" />
</p>

<p>Use the figure at right with the definitions below to understand the life of data in the tier of Ehcache nodes backed by the Terracotta Server Array (TSA), available with <a href="http://terracotta.org/products/bigmemorymax">BigMemory Max</a>. These definitions apply similarly in standalone Ehcache, which is limited to two tiers (heap and disk). <a href="http://terracotta.org/products/bigmemorymax">BigMemory Go</a> can add an off-heap tier to standalone nodes.</p>

<ul>
  <li>Flush – To move a cache entry to a lower tier. Flushing is used to free up resources while still keeping data in the cluster. Entry E1 is shown to be flushed from the L1 off-heap store to the TSA, also known as “L2”.</li>
  <li>Fault – To copy a cache entry from a lower tier to a higher tier. Faulting occurs when data is required at a higher tier but is not resident there. The entry is not deleted from the lower tiers after being faulted. Entry E2 is shown to be faulted from the TSA to the L1 heap.</li>
  <li>Eviction – To remove a cache entry from the cluster. The entry is deleted, and can only be reloaded from a source outside the cluster. Entries are evicted to free up resources. Entry E3, which exists only on the L2 disk, is shown to be evicted from the cluster.</li>
  <li>Expiration – A status based on Time To Live and Time To Idle settings. To maintain cache performance, expired entries  may not be immediately flushed or evicted. Entry E4 is shown to be expired but still in the L1 heap.</li>
  <li>Pinning – To force data to remain in certain tiers. Pinning can be set on individual entries or an entire cache, and must be used with caution to avoid exhausting a resource such as heap. E5 is shown pinned to L1 heap.</li>
</ul>

<p>The sections below explore in more detail the aspects of managing data life in Ehcache and the TSA, including the pinning features of Automatic Resource Control (ARC).</p>

<h2 id="setting-expiration-">Setting Expiration <a name="24283" id="24283"></a></h2>
<p>Cache entries expire based on parameters with configurable values. When eviction occurs, expired elements are the first to be removed. Having an effective expiration configuration is critical to optimizing use of resources such as heap and maintaining cache performance.</p>

<p>To add expiration, edit the values of the following <code class="highlighter-rouge">&lt;cache&gt;</code> attributes and tune these values based on results of performance tests:</p>

<ul>
  <li><code class="highlighter-rouge">timeToIdleSeconds</code> – The maximum number of seconds an element can exist in the cache without being accessed. The element expires at this limit and will no longer be returned from the cache. The default value is 0, which means no TTI eviction takes place (infinite lifetime).</li>
  <li><code class="highlighter-rouge">timeToLiveSeconds</code> – The maximum number of seconds an element can exist in the cache regardless of use. The element expires at this limit and will no longer be returned from the cache. The default value is 0, which means no TTL eviction takes place (infinite lifetime).</li>
  <li><code class="highlighter-rouge">maxEntriesLocalDisk</code> – The maximum sum total number of elements (cache entries) allowed on the disk tier for the cache. If this target is exceeded, eviction occurs to bring the count within the allowed target. The default value is 0, which means no eviction takes place (infinite size is allowed). <strong>A setting of 0 means that no eviction of the cache’s entries takes place, and consequently can cause the node to run out of disk space.</strong></li>
  <li><code class="highlighter-rouge">eternal</code> –  If the cache’s <code class="highlighter-rouge">eternal</code> flag is set, it overrides any finite TTI/TTL values that have been set.</li>
</ul>

<p>See <a href="#30343">How Configuration Affects Element Eviction</a> for more information on how configuration can impact eviction. See this BigMemory Max document on <a href="http://terracotta.org/documentation/2.8/bigmemorymax/configuration/distributed-configuration">distributed cache configuration</a> for definitions of other available configuration properties.</p>

<h2 id="pinning-data">Pinning Data</h2>

<p>Data that should remain in the cache regardless of resource constraints can be pinned.</p>

<p>Entire caches can be pinned using the <code class="highlighter-rouge">pinning</code> element in cache configuration. This element has a required attribute (<code class="highlighter-rouge">store</code>) to specify which data tiers the cache should be pinned to:</p>

<div class="highlighter-rouge">
   <div class="highlight">
      <pre class="highlight">
         <code>&lt;pinning store="localMemory" /&gt;
</code>
      </pre>
   </div>
</div>

<p>The <code class="highlighter-rouge">store</code> attribute can have one of the following values:</p>

<ul>
  <li>localMemory – Cache data is pinned to the local heap (or off-heap for <a href="http://terracotta.org/products/bigmemorygo">BigMemory Go</a> and <a href="http://terracotta.org/products/bigmemorymax">BigMemory Max</a>). Unexpired entries can never be flushed to a lower tier or be evicted.</li>
  <li>inCache – Cache data is pinned in the cache, which can be in any tier cache data is stored. The tier is chosen based on performance-enhancing efficiency algorithms.</li>
</ul>

<p>For example, the following cache is configured to pin its entries:</p>

<div class="highlighter-rouge">
   <div class="highlight">
      <pre class="highlight">
         <code>&lt;cache name="Cache1" ... &gt;
     &lt;pinning store="inCache" /&gt;
&lt;/cache&gt;
</code>
      </pre>
   </div>
</div>

<p>The following cache is configured to pin its entries to heap only:</p>

<div class="highlighter-rouge">
   <div class="highlight">
      <pre class="highlight">
         <code>&lt;cache name="Cache2" ... &gt;
     &lt;pinning store="localMemory" /&gt;
&lt;/cache&gt;
</code>
      </pre>
   </div>
</div>

<h3 id="scope-of-pinning">Scope of Pinning</h3>
<p>Pinning as a setting exists in the local Ehcache client memory. It is never replicated or distributed in a cluster. Pinning achieved programmatically will not be persisted — after a restart the pinned entries are no longer pinned. Cache pinning in configuration is reinstated with the configuration file.</p>

<h3 id="unpinning-caches">Unpinning Caches</h3>
<p>To unpin all of a cache’s pinned entries, clear the cache. Specific entries can be removed from a cache using <code class="highlighter-rouge">Cache.remove()</code>. To empty the entire cache, use <code class="highlighter-rouge">Cache.removeAll()</code>. If the cache itself is removed (<code class="highlighter-rouge">Cache.dispose()</code> or <code class="highlighter-rouge">CacheManager.removeCache()</code>), then any data still remaining in the cache is also removed locally.</p>

<p>Caches can also be cleared using the <a href="https://documentation.softwareag.com/onlinehelp/Rohan/terracotta_437/bigmemory-max/webhelp/index.html#page/bigmemory-max-webhelp%2Fto-title_tcm_user_guide.html%23">Terracotta Management Console</a>.</p>

<h2 id="how-configuration-affects-element-flushing-and-eviction-">How Configuration Affects Element Flushing and Eviction <a name="30343" id="30343"></a></h2>
<p>The following example shows a cache with certain expiration settings:</p>

<div class="highlighter-rouge">
   <div class="highlight">
      <pre class="highlight">
         <code>&lt;cache name="myCache"
      maxEntriesLocalDisk="10000" eternal="false" timeToIdleSeconds="3600"
      timeToLiveSeconds="0" memoryStoreEvictionPolicy="LFU"&gt;
&lt;/cache&gt;
</code>
      </pre>
   </div>
</div>

<p>Note the following about the myCache configuration:</p>

<ul>
  <li>Accessing an entry in myCache that has been idle for more than an hour (<code class="highlighter-rouge">timeToIdleSeconds</code>) causes that element to be evicted.</li>
  <li>If an entry expires but is not accessed, and no resource constraints force eviction, then the expired entry remains in place.</li>
  <li>Entries in myCache can remain in the cache forever if accessed at least once per 60 minutes (<code class="highlighter-rouge">timeToLiveSeconds</code>). However, unexpired entries may still be flushed based on  other limitations (see <a href="/documentation/2.8/configuration/cache-size.html">How to Size Caches</a>).</li>
  <li>In all, myCache can store a maximum of 10000 entries (<code class="highlighter-rouge">maxEntriesLocalDisk</code>). This is the effective maximum number of entries myCache is allowed. Note, however, that this value may be exceeded as it is overridden by settings such as pinning.</li>
</ul>

<h3 id="pinning-overrides-cache-sizing">Pinning Overrides Cache Sizing</h3>
<p>Pinning takes priority over configured cache sizes. For example, in the following cache  pinning configuration overrides the <code class="highlighter-rouge">maxEntriesOnHeap</code> setting:</p>

<div class="highlighter-rouge">
   <div class="highlight">
      <pre class="highlight">
         <code>&lt;cache name="myCache"
     maxEntriesLocalHeap="10000"
     ... &gt;
    &lt;pinning store="localHeap" /&gt;
&lt;/cache&gt;
</code>
      </pre>
   </div>
</div>

<p>While expired cache entries (even ones that have been pinned) can always be flushed and eventually evicted from the cluster, most non-expired elements can as well if resource limitations are reached. However, elements resident in a pinned cache cannot be evicted if they haven’t expired.</p>

<table>
<caption>CAUTION: Pinning Could Cause Failures</caption>
<tr><td>
Potentially, pinned caches could grow to an unlimited size. Caches should never be pinned unless they are designed to hold a limited amount of data (such as reference data) or their usage and expiration characteristics are understood well enough to conclude that they cannot cause errors.
</td></tr>
</table>

      </article>
    </div>

  </div>

</div>

      </div>
    </div>

    <br/>
<footer class="site-footer">

  <div class="container">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        Related Projects:<br/>
        <a href="https://www.terracotta.org"><img src="/images/Terracotta_Logo_sm.png" style="max-height: 16px;"></a><br/><br/>
        <a href="https://www.quartz-scheduler.org"><img src="/images/logo-quartz-scheduler.png" style="max-height: 20px;"></a>

        <!--
        <ul class="contact-list">
          <li>Ehcache</li>
          <li><a href="mailto:tc-oss@wwpdl.vnet.ibm.com">tc-oss@wwpdl.vnet.ibm.com</a></li>
        </ul>
      -->
      </div>
      
    <div class="footer-col  footer-col-2">
      
        <a href="https://github.com/ehcache"><i class="fa fa-github"></i> GitHub</a>
        <br/>
      

      <a href="/downloads/"><i class="fa fa-download"></i> Download Now</a>
      <br/>
      <a href="/documentation/"><i class="fa fa-book"></i> Documentation</a>
      <br/>
      <!--
      <a href="/resources/"><i class="fa fa-external-link-square"></i> Resources</a>
      <br/>
      <a href="/blog/"><i class="fa fa-rss-square"></i> Ehcache Blog</a>
      <br/>
      -->
      <a href="/community/"><i class="fa fa-users"></i> Join the Community</a>
    </div>

    </div>

    <div class="container-fluid">
        <hr/>
        <div class="footer-text">
          <em class="copyleft">Ehcache is Open Source and freely available under the Apache 2 License</em>
        </div>
    </div>
  </div>

</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>

<!--  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.0/jquery.scrollTo.min.js"/> -->

<script type="text/javascript">
        $('#').addClass("active");
        $('#').addClass("active");
</script>


  </body>

</html>
