<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Using Ehcache from within Rails</title><link rel="Prev" href="co-jruby_using_the_jruby_ehcache_api.html" title="Previous"><link rel="Next" href="co-jruby_adding_bigmemory_under_rails.html" title="Next"><link rel="StyleSheet" href="css/_ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/ehcache-webhelp/co-jruby_using_ehcache_from_within_rails.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pRD4W8LpsuGSSOh8trzSqow" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/ehcache-webhelp/co-jruby_using_ehcache_from_within_rails.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/_ehcache_all.1.188.html#wwconnect_header">Related Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-title_ehcache_integrations.html#wwconnect_header">Integrations</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-jruby_using_ehcache_with_jruby_and_rails.html#wwconnect_header">Using Ehcache with JRuby and Rails</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Using Ehcache from within Rails</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_15_9_13_13_1" class="Heading_3">Using Ehcache from within Rails</div><div id="ww3_15_9_13_13_2_2" class="Body">Configuration of Ehcache is still done with the ehcache.xml file, but for Rails applications you must place this file in the config directory of your Rails app. Also note that you must use JRuby to execute your Rails application, as these gems utilize Ruby's Java integration to call the Ehcache API. With this configuration out of the way, you can now use the Ehcache API directly from your Rails controllers and/or models. You could of course create a new Cache object everywhere you want to use it, but it is better to create a single instance and make it globally accessible by creating the Cache object in your Rails environment.rb file. For example, you could add the following lines to config/environment.rb:</div><div id="ww3_15_9_13_13_2_4" class="Preformatted">require 'ehcache' <br>EHCACHE = Ehcache::CacheManager.new.cache</div><div id="ww3_15_9_13_13_2_6" class="Body">By doing so, you make the EHCACHE constant available to all Rails-managed objects in your application. Using the Ehcache API is now just like the above JRuby example. If you are using Rails 3 then you have a better option at your disposal: the built-in Rails 3 caching API. This API provides an abstraction layer for caching underneath which you can plug in any one of a number of caching providers. The most common provider to date has been the memcached provider, but now you can also use the Ehcache provider. Switching to the Ehcache provider requires only one line of code in your Rails environment file (e.g. development.rb or production.rb):</div><div id="ww3_15_9_13_13_2_8" class="Preformatted">config.cache_store = :ehcache_store, { <br>                        :cache_name =&gt; 'rails_cache', <br>                        :ehcache_config =&gt; 'ehcache.xml' <br>                    }</div><div id="ww3_15_9_13_13_2_10" class="Body">This configuration will cause the Rails.cache API to use Ehcache as its cache store. The :cache_name and :ehcache_config are both optional parameters, the default values for which are shown in the above example. The value of the :ehcache_config parameter can be either an absolute path or a relative path, in which case it is interpreted relative to the Rails app’s config directory. A very simple example of the Rails caching API is as follows:</div><div id="ww3_15_9_13_13_2_12" class="Preformatted">Rails.cache.write("answer", "42") <br>Rails.cache.read("answer")  # =&gt; '42'</div><div id="ww3_15_9_13_13_2_14" class="Body">Using this API, your code can be agnostic about the underlying provider, or even switch providers based on the current environment (e.g., memcached in development mode, Ehcache in production). The write method also supports options in the form of a Hash passed as the final parameter.</div><div id="ww3_15_9_13_13_2_16" class="Body">See the "Supported Properties" table in <span class="heading-page"><a href="../ehcache-webhelp/co-jruby_using_the_jruby_ehcache_api.html#wwconnect_header" title="Using the jruby-ehcache API directly">Using the jruby-ehcache API directly</a></span> for the options that are supported. These options are passed to the write method as Hash options using either camelCase or underscore notation, as in the following example:</div><div id="ww3_15_9_13_13_2_18" class="Preformatted">Rails.cache.write('key', 'value', :time_to_idle =&gt; 60.seconds, <br>:timeToLive =&gt; 600.seconds) caches_action :index, <br>:expires_in =&gt; 60.seconds, :unless_exist =&gt; true</div><div id="ww3_15_9_13_13_2_20_2" class="Section_Title">Turn on caching in your controllers</div><div id="ww3_15_9_13_13_2_20_4" class="Body">You can also configure Rails to use Ehcache for its automatic action caching and fragment caching, which is the most common method for caching at the controller level. To enable this, you must configure Rails to perform controller caching, and then set Ehcache as the provider in the same way as for the Rails cache API:</div><div id="ww3_15_9_13_13_2_20_6" class="Preformatted">config.action_controller.perform_caching = true <br>config.action_controller.cache_store = :ehcache_store</div><div id="ww3_15_9_13_13_2_22_2" class="Section_Title">Setting up a Rails Application with Ehcache</div><div id="ww3_15_9_13_13_2_22_4" class="Body">Here are the basic steps for configuring a Rails application to use Ehcache:</div><div id="ww3_15_9_13_13_2_22_6_2_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>1. </span></span>For this example, we will create a new Rails application with the custom template from JRuby.org. The following command creates a "rails-bigmemory" application:</div><div id="ww3_15_9_13_13_2_22_6_2_5" class="Preformatted_1">jruby -S rails new rails-bigmemory -m http://jruby.org/rails3.rb</div><div id="ww3_15_9_13_13_2_22_6_4_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>2. </span></span>The example application will be a simple address book. Generate a scaffold for the address book application, which will create contacts including a first name, last name, and email address.</div><div id="ww3_15_9_13_13_2_22_6_4_5" class="Preformatted_1">jruby -S rails generate scaffold Contact first_name: string last_name: <br>string email_address: string</div><div id="ww3_15_9_13_13_2_22_6_6_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>3. </span></span>Add support for caching with Ehcache. There are several ways to do this, but for this example, we will use the Action Controller caching mechanism. Open the ContactsController.rb. Add a call to the Action method to tell it to cache the results of our index and show pages.</div><div id="ww3_15_9_13_13_2_22_6_6_5" class="Preformatted_1">caches_action :index, :show</div><div id="ww3_15_9_13_13_2_22_6_6_7" class="Numbered_1_Continued">To expire items from the cache as appropriate, add calls to expire the results of the caching calls.</div><div id="ww3_15_9_13_13_2_22_6_6_9" class="Numbered_1_Continued">Under create, add the following:</div><div id="ww3_15_9_13_13_2_22_6_6_11" class="Preformatted_1">expire_action :action =&gt; 'index'</div><div id="ww3_15_9_13_13_2_22_6_6_13" class="Numbered_1_Continued">Under update, add the following:</div><div id="ww3_15_9_13_13_2_22_6_6_15" class="Preformatted_1"> expire_action :action =&gt; 'show', :id =&gt; params[:id] <br> expire_action :action =&gt; 'index'</div><div id="ww3_15_9_13_13_2_22_6_6_17" class="Numbered_1_Continued">Under destroy, add the following:</div><div id="ww3_15_9_13_13_2_22_6_6_19" class="Preformatted_1">  expire_action :action =&gt; 'index'</div><div id="ww3_15_9_13_13_2_22_6_8_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>4. </span></span>Now that the application is configured to support caching, specify Ehcache as its caching provider. Open the Gemfile and declare a dependency on the ehcache-jruby gem. Add the following line:</div><div id="ww3_15_9_13_13_2_22_6_8_5" class="Preformatted_1"> gem 'ehcache-jruby-rails3'</div><div id="ww3_15_9_13_13_2_22_6_10_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>5. </span></span>In the development.rb file, enable caching for the Rails Action Controller mechanism, which is disabled by default in development mode. (Note that caching must be configured for each environment in which you want to use it.) This file also needs a specification for using Ehcache as the cache store provider. Add the following two lines to the .rb file:</div><div id="ww3_15_9_13_13_2_22_6_10_5" class="Preformatted_1"> config.action_controller.perform_caching = true <br> config.cache_store = :ehcache_store</div><div id="ww3_15_9_13_13_2_22_6_12_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>6. </span></span>Run the Bundle Install command.</div><div id="ww3_15_9_13_13_2_22_6_12_5" class="Preformatted_1"> jruby -S bundle install</div><div id="ww3_15_9_13_13_2_22_6_14_3" class="Numbered_1"><span class="WebWorks_Number" style="width: 18pt"><span>7. </span></span>Run the Rake command to create the database and populate the initial schema.</div><div id="ww3_15_9_13_13_2_22_6_14_5" class="Preformatted_1"> jruby -S rake db:create db:migrate</div><div id="ww3_15_9_13_13_2_22_8" class="Body">Now you are ready to start the application with the following command:</div><div id="ww3_15_9_13_13_2_22_10" class="Preformatted">jruby -S rails server</div><div id="ww3_15_9_13_13_2_22_12" class="Body">Once the application is started, populate the cache by adding, editing, and deleting contacts. To see the Contacts address book, enter the following in your browser:</div><div id="ww3_15_9_13_13_2_22_14" class="Preformatted">http://localhost:3000/contacts</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2015</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>