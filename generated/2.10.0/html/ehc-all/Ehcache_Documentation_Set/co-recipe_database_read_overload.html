<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Database Read Overload</title><link rel="Prev" href="co-recipe_empty_cache_values.html" title="Previous"><link rel="Next" href="co-recipe_database_write_overload.html" title="Next"><link rel="StyleSheet" href="css/ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/Ehcache_Documentation_Set/co-recipe_database_read_overload.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pMZb0outP_002f4PlQw9CS_002fqrjg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-recipe_database_read_overload.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/ehcache_all.1.017.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-pubhead_ehcache_recipes.html#wwconnect_header">Ehcache Recipes</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Database Read Overload</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_9_17_1" class="Heading_2">Database Read Overload</div><div id="ww3_12_9_17_3_2_2" class="Body">When many readers simultaneously request the same data element, there can be a database read overload, sometimes called the "Thundering Herd" problem. This recipe addresses how to prevent it in a single JVM or a clustered configuration.</div><div id="ww3_12_9_17_3_4_2" class="Section_Title">Problem</div><div id="ww3_12_9_17_3_4_4" class="Body">Many readers read an empty value from the cache and subsequently try to load it from the database. The result is unnecessary database load as all readers simultaneously execute the same query against the database.</div><div id="ww3_12_9_17_3_6_2" class="Section_Title">Solution</div><div id="ww3_12_9_17_3_6_4" class="Body">Implement the <span class="xref">cache-as-sor</span> pattern by using a <span class="xref">BlockingCache or SelfPopulatingCache</span> included with Ehcache.</div><div id="ww3_12_9_17_3_6_6" class="Body">Using the BlockingCache Ehcache will automatically block all threads that are simultaneously requesting a particular value and let one and only one thread through to the database. Once that thread has populated the cache, the other threads will be allowed to read the cached value.</div><div id="ww3_12_9_17_3_6_8" class="Body">Even better, when used in a cluster with Terracotta, Ehcache will automatically coordinate access to the cache across the cluster, and no matter how many application servers are deployed, still only one user request will be serviced by the database on cache misses.</div><div id="ww3_12_9_17_3_8_2" class="Section_Title">Discussion</div><div id="ww3_12_9_17_3_8_4" class="Body">The "thundering herd" problem occurs in a highly concurrent environment (typically, many users). When many users make a request to the same piece of data at the same time, and there is a cache miss (the data for the cached element is not present in the cache) the thundering herd problem is triggered.</div><div id="ww3_12_9_17_3_8_6" class="Body">Imagine that a popular news story has just surfaced on the front page of a news site. The news story has not yet been loaded in to the cache.</div><div id="ww3_12_9_17_3_8_8" class="Body">The application is using a cache using a read-through pattern with code that looks approximately like:</div><div id="ww3_12_9_17_3_8_10" class="Preformatted">/* read some data, check cache first, otherwise read from sor */ <br>public V readSomeData(K key) <br>{ <br>    Element element; <br>    if ((element = cache.get(key)) != null) { <br>        return element.getValue(); <br>    } <br>    // note here you should decide whether your cache <br>    // will cache 'nulls' or not <br>    if (value = readDataFromDataStore(key)) != null) { <br>        cache.put(new Element(key, value)); <br>    } <br>    return value; <br>}</div><div id="ww3_12_9_17_3_8_12" class="Body">Upon publication to the front page of a website, a news story will then likely be clicked on by many users all at approximately the same time.</div><div id="ww3_12_9_17_3_8_14" class="Body">Since the application server is processing all of the user requests simultaneously, the application code will execute the above code all at approximately the same time. This is especially important to consider, because all user requests will be evaluating the cache (line 105) contents at approximately the same time, and reach the same conclusion: the cache request is a miss!</div><div id="ww3_12_9_17_3_8_16" class="Body">Therefore all of the user request threads will then move on to read the data from the SOR. So, even though the application designer was careful to implement caching in the application, the database is still subject to spikes of activity.</div><div id="ww3_12_9_17_3_8_18" class="Body">The thundering herd problem is made even worse when there are many application servers to one database server, as the number of simultaneous hits the database server may receive increases as a function of the number of application servers deployed.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2015</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>