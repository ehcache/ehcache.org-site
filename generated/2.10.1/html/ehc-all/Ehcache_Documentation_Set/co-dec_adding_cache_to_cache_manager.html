<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Adding Decorated Caches to a CacheManager</title><link rel="Prev" href="co-dec_creating_a_decorator_3.html" title="Previous"><link rel="Next" href="to-ext_cache_extensions.html" title="Next"><link rel="StyleSheet" href="css/_ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/ehcache-webhelp/co-dec_adding_cache_to_cache_manager.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN_002b3L9_002fb3m7Y5on04VDX0oXg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/ehcache-webhelp/co-dec_adding_cache_to_cache_manager.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/_ehcache_all.1.016.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-title_ehcache_developer_guide.html#wwconnect_header">Ehcache Developer Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-dec_cache_decorators.html#wwconnect_header">Cache Decorators</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Adding Decorated Caches to a CacheManager</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_3_31_12_1" class="Heading_3">Adding Decorated Caches to a CacheManager</div><div id="ww3_12_3_31_12_3_2" class="Body">Having created a decorator programmatically, it is generally useful to put it in a place where multiple threads can access it. Note that decorators created via configuration in ehcache.xml have already been added to the CacheManager.</div><div id="ww3_12_3_31_12_3_4_2" class="Section_Title">Using CacheManager.replaceCacheWithDecoratedCache()</div><div id="ww3_12_3_31_12_3_4_4" class="Body">A built-in way is to replace the Cache in CacheManager with the decorated one. This is achieved as in the following example:</div><div id="ww3_12_3_31_12_3_4_6" class="Preformatted">cacheManager.replaceCacheWithDecoratedCache(cache, newBlockingCache);</div><div id="ww3_12_3_31_12_3_4_8" class="Body">The CacheManager.replaceCacheWithDecoratedCache( ) method requires that the decorated cache be built from the underlying cache from the same name.</div><div id="ww3_12_3_31_12_3_4_10" class="Body">Note that any overridden Ehcache methods will take on new behaviors without casting, as per the normal rules of Java. Casting is only required for new methods that the decorator introduces.</div><div id="ww3_12_3_31_12_3_4_12" class="Body">Any calls to get the cache out of the CacheManager now return the decorated one.</div><div id="ww3_12_3_31_12_3_4_14" class="Body">A word of caution. This method should be called in an appropriately synchronized init style method before multiple threads attempt to use it. All threads must be referencing the same decorated cache. An example of a suitable init method is found in CachingFilter:</div><div id="ww3_12_3_31_12_3_4_16" class="Preformatted">/** <br>* The cache holding the web pages. Ensure that all threads for a given cache <br>* name are using the same instance of this. <br>*/ <br>private BlockingCache blockingCache; <br>/** <br>* Initialises blockingCache to use <br>* <br>* @throws CacheException The most likely cause is that a cache has not been <br>*                        configured in Ehcache's configuration file ehcache.xml <br>*                        for the filter name <br>*/ <br>public void doInit() throws CacheException { <br>  synchronized (this.getClass()) { <br>    if (blockingCache == null) { <br>      final String cacheName = getCacheName(); <br>      Ehcache cache = getCacheManager().getEhcache(cacheName); <br>      if (!(cache instanceof BlockingCache)) { <br>        //decorate and substitute <br>        BlockingCache newBlockingCache = new BlockingCache(cache); <br>        getCacheManager().replaceCacheWithDecoratedCache(cache, newBlockingCache); <br>      } <br>      blockingCache = (BlockingCache) getCacheManager().getEhcache(getCacheName()); <br>    } <br>  } <br>}</div><div id="ww3_12_3_31_12_3_4_18" class="Preformatted">Ehcache blockingCache = singletonManager.getEhcache("sampleCache1");</div><div id="ww3_12_3_31_12_3_4_20" class="Body">The returned cache will exhibit the decorations.</div><div id="ww3_12_3_31_12_3_6_2" class="Section_Title">Using CacheManager.addDecoratedCache()</div><div id="ww3_12_3_31_12_3_6_4" class="Body">Sometimes you want to add a decorated cache but retain access to the underlying cache.</div><div id="ww3_12_3_31_12_3_6_6" class="Body">The way to do this is to create a decorated cache and then call cache.setName(new_name) and then add it to CacheManager with CacheManager.addDecoratedCache().</div><div id="ww3_12_3_31_12_3_6_8" class="Preformatted">/** <br>* Adds a decorated {@link Ehcache} to the CacheManager. This method neither <br>* creates the memory/disk store nor initializes the cache. It only adds the  <br>* cache reference to the map of caches held by this cacheManager. <br>* <br>* It is generally required that a decorated cache, once constructed, is made <br>* available to other execution threads. The simplest way of doing this is to <br>* either add it to the cacheManager with a different name or substitute the <br>* original cache with the decorated one. <br>* <br>* This method adds the decorated cache assuming it has a different name. <br>* If another cache (decorated or not) with the same name already exists, <br>* it will throw {@link ObjectExistsException}. For replacing existing <br>* cache with another decorated cache having same name, please use <br>* {@link #replaceCacheWithDecoratedCache(Ehcache, Ehcache)} <br>* <br>* Note that any overridden Ehcache methods by the decorator will take on <br>* new behaviours without casting. Casting is only required for new methods <br>* that the decorator introduces. For more information see the well known <br>* Gang of Four Decorator pattern. <br>* <br>* @param decoratedCache <br>* @throws ObjectExistsException <br>*             if another cache with the same name already exists. <br>*/ <br>public void addDecoratedCache(Ehcache decoratedCache) throws ObjectExistsException {</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>