<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Code Samples</title><link rel="Prev" href="co-jms_ehcache_replication_and_external_publishers_3.html" title="Previous"><link rel="Next" href="co-jms_using_the_jms_cache_loader.html" title="Next"><link rel="StyleSheet" href="css/_ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/ehcache-webhelp/co-jms_ehcache_replication_and_external_publishers_4.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pKYHrGre9CR2p7mzCTJIiXQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/ehcache-webhelp/co-jms_ehcache_replication_and_external_publishers_4.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/_ehcache_all.1.187.html#wwconnect_header">Related Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-title_ehcache_replication_guide.html#wwconnect_header">Ehcache Replication Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-jms_replicated_caching_using_jms.html#wwconnect_header">Replicated Caching Using JMS</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/co-jms_ehcache_replication_and_external_publishers.html#wwconnect_header">Ehcache Replication and External Publishers</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Code Samples</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_15_5_13_8_7_2" class="Heading_4">Code Samples</div><div id="ww3_15_5_13_8_7_4_2" class="Body">These samples use Open MQ as the message queue and use it with out of the box defaults. They are heavily based on Ehcache's own JMS integration tests. See the test source for more details.</div><div id="ww3_15_5_13_8_7_4_4" class="Body">Messages should be sent to the topic that Ehcache is listening on. In these samples it is EhcacheTopicDest.</div><div id="ww3_15_5_13_8_7_4_6" class="Body">All samples get a Topic Connection using the following method:</div><div id="ww3_15_5_13_8_7_4_8" class="Preformatted">private TopicConnection getMQConnection() throws JMSException { <br>  com.sun.messaging.ConnectionFactory factory = <br>    new com.sun.messaging.ConnectionFactory(); <br>  factory.setProperty(ConnectionConfiguration.imqAddressList, "localhost:7676"); <br>  factory.setProperty(ConnectionConfiguration.imqReconnectEnabled, "true"); <br>  TopicConnection myConnection = factory.createTopicConnection(); <br>  return myConnection; <br>}</div><div id="ww3_15_5_13_8_7_4_10_2" class="Section_Title">PUT a Java Object into an Ehcache Cluster</div><div id="ww3_15_5_13_8_7_4_10_4" class="Preformatted">String payload = "this is an object"; <br>TopicConnection connection = getMQConnection(); <br>connection.start(); <br>TopicSession publisherSession = <br>  connection.createTopicSession(false, Session.AUTO_ACKNOWLEDGE); <br>ObjectMessage message = publisherSession.createObjectMessage(payload); <br>message.setStringProperty(ACTION_PROPERTY, "PUT"); <br>message.setStringProperty(CACHE_NAME_PROPERTY, "sampleCacheAsync"); <br>//don't set. Should work. <br>//message.setStringProperty(MIME_TYPE_PROPERTY, null); <br>//should work. Key should be ignored when sending an element. <br>message.setStringProperty(KEY_PROPERTY, "1234"); <br>Topic topic = publisherSession.createTopic("EhcacheTopicDest"); <br>TopicPublisher publisher = publisherSession.createPublisher(topic); <br>publisher.send(message); <br>connection.stop();</div><div id="ww3_15_5_13_8_7_4_10_6" class="Body">Ehcache will create an Element in cache "sampleCacheAsync" with key "1234" and a Java class String value of "this is an object".</div><div id="ww3_15_5_13_8_7_4_12_2" class="Section_Title">PUT XML into an Ehcache Cluster</div><div id="ww3_15_5_13_8_7_4_12_4" class="Preformatted">TopicConnection connection = getMQConnection(); <br>connection.start(); <br>TopicSession publisherSession = connection.createTopicSession(false, <br>  Session.AUTO_ACKNOWLEDGE); <br>String value = "&lt;?xml version=\"1.0\"?&gt;\n" + <br>   "&lt;oldjoke&gt;\n" + <br>   "&lt;burns&gt;Say &lt;quote&gt;goodnight&lt;/quote&gt;,\n" + <br>   "Gracie.&lt;/burns&gt;\n" + <br>   "&lt;allen&gt;&lt;quote&gt;Goodnight, \n" + <br>   "Gracie.&lt;/quote&gt;&lt;/allen&gt;\n" + <br>   "&lt;applause/&gt;\n" + <br>   "&lt;/oldjoke&gt;"; <br>TextMessage message = publisherSession.createTextMessage(value); <br>message.setStringProperty(ACTION_PROPERTY, "PUT"); <br>message.setStringProperty(CACHE_NAME_PROPERTY, "sampleCacheAsync"); <br>message.setStringProperty(MIME_TYPE_PROPERTY, "application/xml"); <br>message.setStringProperty(KEY_PROPERTY, "1234"); <br>Topic topic = publisherSession.createTopic("EhcacheTopicDest"); <br>TopicPublisher publisher = publisherSession.createPublisher(topic); <br>publisher.send(message); <br>connection.stop();</div><div id="ww3_15_5_13_8_7_4_12_6" class="Body">Ehcache will create an Element in cache "sampleCacheAsync" with key "1234" and a value of type MimeTypeByteArray.</div><div id="ww3_15_5_13_8_7_4_12_8" class="Body">On a get from the cache the MimeTypeByteArray will be returned. It is an Ehcache value object from which a mimeType and byte[] can be retrieved. The mimeType will be "application/xml". The byte[] will contain the XML String encoded in bytes, using the platform's default charset.</div><div id="ww3_15_5_13_8_7_4_14_2" class="Section_Title">PUT arbitrary bytes into an Ehcache Cluster</div><div id="ww3_15_5_13_8_7_4_14_4" class="Preformatted">byte[] bytes = new byte[]{0x34, (byte) 0xe3, (byte) 0x88}; <br>TopicConnection connection = getMQConnection(); <br>connection.start(); <br>TopicSession publisherSession = connection.createTopicSession(false, <br>  Session.AUTO_ACKNOWLEDGE); <br>BytesMessage message = publisherSession.createBytesMessage(); <br>message.writeBytes(bytes); <br>message.setStringProperty(ACTION_PROPERTY, "PUT"); <br>message.setStringProperty(CACHE_NAME_PROPERTY, "sampleCacheAsync"); <br>message.setStringProperty(MIME_TYPE_PROPERTY, "application/octet-stream"); <br>message.setStringProperty(KEY_PROPERTY, "1234"); <br>Topic topic = publisherSession.createTopic("EhcacheTopicDest"); <br>TopicPublisher publisher = publisherSession.createPublisher(topic); <br>publisher.send(message);</div><div id="ww3_15_5_13_8_7_4_14_6" class="Body">Ehcache will create an Element in cache "sampleCacheAsync" with key "1234" in and a value of type MimeTypeByteArray.</div><div id="ww3_15_5_13_8_7_4_14_8" class="Body">On a get from the cache the MimeTypeByteArray will be returned. It is an Ehcache value object from which a mimeType and byte[] can be retrieved. The mimeType will be "application/octet-stream". The byte[] will contain the original bytes.</div><div id="ww3_15_5_13_8_7_4_16_2" class="Section_Title">REMOVE</div><div id="ww3_15_5_13_8_7_4_16_4" class="Preformatted">TopicConnection connection = getMQConnection(); <br>connection.start(); <br>TopicSession publisherSession = connection.createTopicSession(false, <br>  Session.AUTO_ACKNOWLEDGE); <br>ObjectMessage message = publisherSession.createObjectMessage(); <br>message.setStringProperty(ACTION_PROPERTY, "REMOVE"); <br>message.setStringProperty(CACHE_NAME_PROPERTY, "sampleCacheAsync"); <br>message.setStringProperty(KEY_PROPERTY, "1234"); <br>Topic topic = publisherSession.createTopic("EhcacheTopicDest"); <br>TopicPublisher publisher = publisherSession.createPublisher(topic); <br>publisher.send(message);</div><div id="ww3_15_5_13_8_7_4_16_6" class="Body">Ehcache will remove the Element with key "1234" from cache "sampleCacheAsync" from the cluster.</div><div id="ww3_15_5_13_8_7_4_18_2" class="Section_Title">REMOVE ALL</div><div id="ww3_15_5_13_8_7_4_18_4" class="Preformatted">TopicConnection connection = getMQConnection(); <br>connection.start(); <br>TopicSession publisherSession = connection.createTopicSession(false, <br>Session.AUTO_ACKNOWLEDGE); <br>ObjectMessage message = publisherSession.createObjectMessage(); <br>message.setStringProperty(ACTION_PROPERTY, "REMOVE_ALL"); <br>message.setStringProperty(CACHE_NAME_PROPERTY, "sampleCacheAsync"); <br>Topic topic = publisherSession.createTopic("EhcacheTopicDest"); <br>TopicPublisher publisher = publisherSession.createPublisher(topic); <br>publisher.send(message); <br>connection.stop();</div><div id="ww3_15_5_13_8_7_4_18_6" class="Body">Ehcache will remove all Elements from cache "sampleCacheAsync" in the cluster.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>