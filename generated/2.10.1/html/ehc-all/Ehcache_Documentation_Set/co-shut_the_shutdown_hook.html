<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>The Shutdown Hook</title><link rel="Prev" href="co-shut_servlet_context_listener.html" title="Previous"><link rel="Next" href="co-shut_dirty_shutdown.html" title="Next"><link rel="StyleSheet" href="css/ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/Ehcache_Documentation_Set/co-shut_the_shutdown_hook.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pRWwgJYvJ7ofEN01lvX45Jg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-shut_the_shutdown_hook.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.016.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-title_ehcache_operations_guide.html#wwconnect_header">Ehcache Operations Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-shut_shutting_down_ehcache.html#wwconnect_header">Shutting Down Ehcache</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">The Shutdown Hook</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_7_13_10_1" class="Heading_3">The Shutdown Hook</div><div id="ww3_12_7_13_10_3_2" class="Body">The CacheManager can optionally register a shutdown hook. To do so, set the system property <span class="codeph">net.sf.ehcache.enableShutdownHook=true</span>. This will shut down the CacheManager when it detects the Virtual Machine shutting down and it is not already shut down.</div><div id="ww3_12_7_13_10_3_4" class="Body">Use the shutdown hook when the CacheManager is not already being shutdown by a framework you are using, or by your application.</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_7_13_10_3_6_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_7_13_10_3_6_1_3_1_2" class="Table_Cell">Shutdown hooks are inherently problematic. The JVM is shutting down, so sometimes things that can never be null are. Ehcache guards against as many of these as it can, but the shutdown hook should be the last option to use.</div></td></tr></table></div><div id="ww3_12_7_13_10_3_8" class="Body">The shutdown hook is on CacheManager. It simply calls the shutdown method. The sequence of events is:</div><div id="ww3_12_7_13_10_3_10_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Call dispose for each registered CacheManager event listener.</div><div id="ww3_12_7_13_10_3_10_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Call dispose for each Cache.</div><div id="ww3_12_7_13_10_3_12" class="Body">Each Cache will:</div><div id="ww3_12_7_13_10_3_14_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Shutdown the MemoryStore. The MemoryStore will flush to the DiskStore.</div><div id="ww3_12_7_13_10_3_14_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Shutdown the DiskStore. If the DiskStore is persistent ("localRestartable"), it will write the entries and index to disk.</div><div id="ww3_12_7_13_10_3_14_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Shutdown each registered CacheEventListener.</div><div id="ww3_12_7_13_10_3_14_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Set the Cache status to shutdown, preventing any further operations on it.</div><div id="ww3_12_7_13_10_3_14_10" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Set the CacheManager status to shutdown, preventing any further operations on it.</div><div id="ww3_12_7_13_10_3_16" class="Body">The shutdown hook runs when:</div><div id="ww3_12_7_13_10_3_18_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>A program exists normally. For example, when System.exit() is called, or when the last non-daemon thread exits.</div><div id="ww3_12_7_13_10_3_18_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>The Virtual Machine is terminated, e.g., CTRL-C. This corresponds to <span class="codeph">kill -SIGTERM pid</span> or <span class="codeph">kill -15 pid</span> on Unix systems.</div><div id="ww3_12_7_13_10_3_20" class="Body">The shutdown hook will not run when:</div><div id="ww3_12_7_13_10_3_22_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>The Virtual Machine aborts.</div><div id="ww3_12_7_13_10_3_22_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>A SIGKILL signal is sent to the Virtual Machine process on Unix systems, e.g., <span class="codeph">kill -SIGKILL pid</span> or <span class="codeph">kill -9 pid</span>.</div><div id="ww3_12_7_13_10_3_22_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>A <span class="codeph">TerminateProcess</span> call is sent to the process on Windows systems.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2015</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>