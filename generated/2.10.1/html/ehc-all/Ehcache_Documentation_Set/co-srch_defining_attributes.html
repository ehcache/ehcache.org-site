<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Defining Attributes</title><link rel="Prev" href="co-srch_making_cache_searchable.html" title="Previous"><link rel="Next" href="co-srch_creating_a_query.html" title="Next"><link rel="StyleSheet" href="css/_ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/ehcache-webhelp/co-srch_defining_attributes.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN82KkLSeDL6zQhzO75521Yw" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/ehcache-webhelp/co-srch_defining_attributes.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/_ehcache_all.1.016.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-title_ehcache_developer_guide.html#wwconnect_header">Ehcache Developer Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../ehcache-webhelp/to-srch_searching_a_cache.html#wwconnect_header">Searching a Cache</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Defining Attributes</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_3_13_10_1" class="Heading_3">Defining Attributes</div><div id="ww3_12_3_13_10_3_2" class="Body">In addition to configuring a cache to be searchable, you must define the attributes to be used in searches.</div><div id="ww3_12_3_13_10_3_4" class="Body">Attributes are extracted from keys or values during search by using AttributeExtractors. An extracted attribute must be one of the following types:</div><div id="ww3_12_3_13_10_3_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Boolean</div><div id="ww3_12_3_13_10_3_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Byte</div><div id="ww3_12_3_13_10_3_6_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Character</div><div id="ww3_12_3_13_10_3_6_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Double</div><div id="ww3_12_3_13_10_3_6_10" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Float</div><div id="ww3_12_3_13_10_3_6_12" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Integer</div><div id="ww3_12_3_13_10_3_6_14" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Long</div><div id="ww3_12_3_13_10_3_6_16" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Short</div><div id="ww3_12_3_13_10_3_6_18" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>String</div><div id="ww3_12_3_13_10_3_6_20" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>java.util.Date</div><div id="ww3_12_3_13_10_3_6_22" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>java.sql.Date</div><div id="ww3_12_3_13_10_3_6_24" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Enum</div><div id="ww3_12_3_13_10_3_8" class="Body">These types correspond to the AttributeType enum specified by the Ehcache Javadoc at <span class="external"><a href="http://ehcache.org/apidocs/2.10.1/net/sf/ehcache/search/attribute/AttributeType.html" target="external_window">http://ehcache.org/apidocs/2.10.1/net/sf/ehcache/search/attribute/AttributeType.html</a></span>.</div><div id="ww3_12_3_13_10_3_10" class="Body">Type name matching is case sensitive. For example, Double resolves to the java.lang.Double class type, and double is interpreted as the primitive double type.</div><div id="ww3_12_3_13_10_3_12_2" class="Section_Title">Search API Example</div><div id="ww3_12_3_13_10_3_12_4" class="Preformatted">&lt;searchable&gt; <br>&lt;searchAttribute name="age" type="Integer"/&gt; <br>&lt;/searchable&gt;</div><div id="ww3_12_3_13_10_3_14_2" class="Body">If an attribute cannot be found or is of the wrong type, an AttributeExtractorException is thrown on search execution. !</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_13_10_3_14_4_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_13_10_3_14_4_1_3_1_2" class="Table_Cell">On the first use of an attribute, the attribute type is detected, validated against supported types, and saved automatically. Once the type is established, it cannot be changed. For example, if an integer value was initially returned for attribute named "Age" by the attribute extractor, it is an error for the extractor to return a float for this attribute later on.</div></td></tr></table></div><div id="ww3_12_3_13_10_3_16_2" class="Section_Title">Well-known Attributes</div><div id="ww3_12_3_13_10_3_16_4" class="Body">The parts of an Element that are well-known attributes can be referenced by some predefined, well-known names. If a key and/or value is of a supported search type, it is added automatically as an attribute with the name "key" or "value." These well-known attributes have the convenience of being constant attributes made available in the Query class. For example, the attribute for "key" can be referenced in a query by <span class="codeph">Query.KEY</span>. For even greater readability, statically import so that, in this example, you would use <span class="codeph">KEY</span>.</div><div class="ww_skin_page_overflow"><table class="Table" summary=""><tr><td class="Table_Cell_Head" style="background-color: #D6D6D6; border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: bottom; width: 149.976pt"><div id="ww3_12_3_13_10_3_16_6_2_6_2_2" class="Table_Cell_Head">Well-known Attribute Name</div></td><td class="Table_Cell_Head" style="background-color: #D6D6D6; border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: bottom; width: 144pt"><div id="ww3_12_3_13_10_3_16_6_2_6_2_4" class="Table_Cell_Head">Attribute Constant</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_12_3_13_10_3_16_6_2_8_2_2" class="Table_Cell">key</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_12_3_13_10_3_16_6_2_8_2_4" class="Table_Cell">Query.KEY</div></td></tr><tr><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_12_3_13_10_3_16_6_2_8_4_2" class="Table_Cell">value</div></td><td class="Table_Cell" style="border-bottom-color: Black; border-bottom-style: solid; border-bottom-width: 1px; border-left-color: Black; border-left-style: solid; border-left-width: 1px; border-right-color: Black; border-right-style: solid; border-right-width: 1px; border-top-color: Black; border-top-style: solid; border-top-width: 1px; padding-bottom: 3px; padding-left: 8px; padding-right: 8px; padding-top: 0px; vertical-align: top"><div id="ww3_12_3_13_10_3_16_6_2_8_4_4" class="Table_Cell">Query.VALUE</div></td></tr></table></div><div id="ww3_12_3_13_10_3_18_2" class="Section_Title">Reflection Attribute Extractor</div><div id="ww3_12_3_13_10_3_18_4" class="Body">The ReflectionAttributeExtractor is a built-in search attribute extractor that uses JavaBean conventions and also understands a simple form of expression. Where a JavaBean property is available and it is of a searchable type, it can be declared:</div><div id="ww3_12_3_13_10_3_18_6" class="Preformatted">&lt;cache&gt; <br>  &lt;searchable&gt; <br>    &lt;searchAttribute name="age"/&gt; <br>  &lt;/searchable&gt; <br>&lt;/cache&gt;</div><div id="ww3_12_3_13_10_3_18_8" class="Body">The expression language of the ReflectionAttributeExtractor also uses method/value dotted expression chains. The expression chain must start with "key", "value", or "element". From the starting object, a chain of method calls or field names follows. Method calls and field names can be freely mixed in the chain:</div><div id="ww3_12_3_13_10_3_18_10" class="Preformatted">&lt;cache&gt; <br>  &lt;searchable&gt; <br>    &lt;searchAttribute name="age" expression="value.person.getAge()"/&gt; <br>  &lt;/searchable&gt; <br>&lt;/cache&gt; <br>&lt;cache&gt; <br>  &lt;searchable&gt; <br>     &lt;searchAttribute name="name" expression="element.toString()"/&gt; <br>  &lt;/searchable&gt; <br>&lt;/cache&gt;</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_13_10_3_18_12_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_13_10_3_18_12_1_3_1_2" class="Table_Cell">The method and field name portions of the expression are case-sensitive.</div></td></tr></table></div><div id="ww3_12_3_13_10_3_20_2" class="Section_Title">Custom Attribute Extractor</div><div id="ww3_12_3_13_10_3_20_4" class="Body">In more complex situations, you can create your own attribute extractor by implementing the AttributeExtractor interface. The interface's attributeFor(&nbsp;) method returns the attribute value for the element and attribute name you specify.</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_13_10_3_20_6_1_3_1_1_1" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_12_3_13_10_3_20_6_1_3_1_2" class="Table_Cell">These examples assume there are previously created Person objects containing attributes such as name, age, and gender.</div></td></tr></table></div><div id="ww3_12_3_13_10_3_20_8" class="Body">Provide your extractor class:</div><div id="ww3_12_3_13_10_3_20_10" class="Preformatted">&lt;cache name="cache2" maxEntriesLocalHeap="0" eternal="true"&gt; <br>  &lt;persistence strategy="none"/&gt; <br>  &lt;searchable&gt; <br>     &lt;searchAttribute name="age" class="net.sf.ehcache.search.TestAttributeExtractor"/&gt; <br>  &lt;/searchable&gt; <br>&lt;/cache&gt;</div><div id="ww3_12_3_13_10_3_20_12" class="Body">A custom attribute extractor could be passed an Employee object to extract a specific attribute:</div><div id="ww3_12_3_13_10_3_20_14" class="Preformatted">returnVal = employee.getdept();</div><div id="ww3_12_3_13_10_3_20_16" class="Body">If you need to pass state to your custom extractor, specify properties:</div><div id="ww3_12_3_13_10_3_20_18" class="Preformatted">&lt;cache&gt; <br>  &lt;searchable&gt; <br>    &lt;searchAttribute name="age" <br>    class="net.sf.ehcache.search.TestAttributeExtractor" <br>    properties="foo=this,bar=that,etc=12" /&gt; <br>  &lt;/searchable&gt; <br>&lt;/cache&gt;</div><div id="ww3_12_3_13_10_3_20_20" class="Body">If properties are provided, the attribute extractor implementation must have a public constructor that accepts a single java.util.Properties instance.</div><div id="ww3_12_3_13_10_3_22_2" class="Section_Title">Dynamic Attributes Extractor</div><div id="ww3_12_3_13_10_3_22_4" class="Body">The DynamicAttributesExtractor provides flexibility by allowing the search configuration to be changed after the cache is initialized. This is done with one method call, at the point of element insertion into the cache. The DynamicAttributesExtractor method returns a map of attribute names to index and their respective values. This method is called for every Ehcache.put(&nbsp;) and replace(&nbsp;) invocation.</div><div id="ww3_12_3_13_10_3_22_6" class="Body">Assuming that we have previously created Person objects containing attributes such as name, age, and gender, the following example shows how to create a dynamically searchable cache and register the DynamicAttributesExtractor:</div><div id="ww3_12_3_13_10_3_22_8" class="Preformatted">Configuration config = new Configuration(); <br>config.setName("default"); <br>CacheConfiguration cacheCfg = new CacheConfiguration("PersonCache"); <br>cacheCfg.setEternal(true); <br>cacheCfg.terracotta(new TerracottaConfiguration().clustered(true)); <br>Searchable searchable = new Searchable().allowDynamicIndexing(true); <br>cacheCfg.addSearchable(searchable); <br>config.addCache(cacheCfg); <br>CacheManager cm = new CacheManager(config); <br>Ehcache cache = cm.getCache("PersonCache"); <br>final String attrNames[] = {"first_name", "age"}; <br>// Now you can register a dynamic attribute extractor to index <br>// the cache elements, using a subset of known fields <br>cache.registerDynamicAttributesExtractor(new DynamicAttributesExtractor() { <br>    Map&lt;String, Object&gt; attributesFor(Element element) { <br>        Map&lt;String, Object&gt; attrs = new HashMap&lt;String, Object&gt;(); <br>        Person value = (Person)element.getObjectValue(); <br>        // For example, extract first name only <br>        String fName = value.getName() == null ? null : value.getName(). <br>        split("\\s+")[0]; <br>        attrs.put(attrNames[0], fName); <br>        attrs.put(attrNames[1], value.getAge()); <br>        return attrs; <br>    } <br>}); <br>// Now add some data to the cache <br>cache.put(new Element(10, new Person("John Doe", 34, Person.Gender.MALE)));</div><div id="ww3_12_3_13_10_3_22_10" class="Body">Given the code above, the newly put element would be indexed on values of name and age fields, but not gender. If, at a later time, you would like to start indexing the element data on gender, you would need to create a new DynamicAttributesExtractor instance that extracts that field for indexing.</div><div id="ww3_12_3_13_10_3_24_2" class="Section_Title">Dynamic Search Rules</div><div id="ww3_12_3_13_10_3_24_4_2_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>To use the DynamicAttributesExtractor, the cache must be configured to be searchable and dynamically indexable. For information about making a cache searchable, see <span class="heading-page"><a href="../ehcache-webhelp/co-srch_making_cache_searchable.html#wwconnect_header" title="Making a Cache Searchable">Making a Cache Searchable</a></span>.</div><div id="ww3_12_3_13_10_3_24_4_4_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>A dynamically searchable cache must have a dynamic extractor registered BEFORE data is added to it. (This is to prevent potential races between extractor registration and cache loading which might result in an incomplete set of indexed data, leading to erroneous search results.)</div><div id="ww3_12_3_13_10_3_24_4_6_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Each call on the DynamicAttributesExtractor method replaces the previously registered extractor, because there can be at most one extractor instance configured for each such cache.</div><div id="ww3_12_3_13_10_3_24_4_8_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>If a dynamically searchable cache is initially configured with a predefined set of search attributes, this set of attributes is always be queried for extracted values, regardless of whether or not a dynamic search attribute extractor has been configured.</div><div id="ww3_12_3_13_10_3_24_4_10_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>The initial search configuration takes precedence over dynamic attributes, so if the dynamic attribute extractor returns an attribute name already used in the initial searchable configuration, an exception is thrown.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2016</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>