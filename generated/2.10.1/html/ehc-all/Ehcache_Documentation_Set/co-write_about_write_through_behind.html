<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>About Write-Through and Write-Behind Caches</title><link rel="Prev" href="to-writethrough_and_writebehind_caches.html" title="Previous"><link rel="Next" href="co-write_using_combined_read_through_write_behind.html" title="Next"><link rel="StyleSheet" href="css/ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/Ehcache_Documentation_Set/co-write_about_write_through_behind.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pQTubeLkplUdp5RZxVbsarQ" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-write_about_write_through_behind.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.016.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-title_ehcache_developer_guide.html#wwconnect_header">Ehcache Developer Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-writethrough_and_writebehind_caches.html#wwconnect_header">Write-Through and Write-Behind Caches</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">About Write-Through and Write-Behind Caches</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_3_21_6_1" class="Heading_3">About Write-Through and Write-Behind Caches</div><div id="ww3_12_3_21_6_3_2" class="Body">Write-through caching is a caching pattern where writes to the cache cause writes to an underlying resource. The cache acts as a facade to the underlying resource. With this pattern, it often makes sense to read through the cache too.</div><div id="ww3_12_3_21_6_3_4" class="Body">Write-behind caching uses the same client API; however, the write happens asynchronously.</div><div id="ww3_12_3_21_6_3_6" class="Body">While file systems or a web-service clients can underlie the facade of a write-through cache, the most common underlying resource is a database. To simplify the discussion, we will use the database as the example resource.</div><div id="ww3_12_3_21_6_3_8_2" class="Section_Title">Potential Benefits of Write-Behind</div><div id="ww3_12_3_21_6_3_8_4" class="Body">The major benefit of write-behind is database offload. This can be achieved in a number of ways:</div><div id="ww3_12_3_21_6_3_8_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Time shifting</span> - moving writes to a specific time or time interval. For example, writes could be batched up and written overnight, or at 5 minutes past the hour, to avoid periods of peak contention.</div><div id="ww3_12_3_21_6_3_8_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Rate limiting</span> - spreading writes out to flatten peaks. Say a point-of-sale (POS) network has an end-of-day procedure where data gets written to a central server. All POS nodes in the same time zone will write all at once. A very large peak will occur. Using rate limiting, writes could be limited to 100 TPS to whittle down the queue of writes over several hours</div><div id="ww3_12_3_21_6_3_8_6_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="inlinetitle">Conflation</span> - consolidate writes to create fewer transactions. For example, a value in a database row is updated by 5 writes, incrementing it from 10 to 20 to 31 to 40 to 45. Using conflation, the 5 transactions are replaced by one to update the value from 10 to 45.</div><div id="ww3_12_3_21_6_3_8_8" class="Body">These benefits must be weighed against the limitations and constraints imposed.</div><div id="ww3_12_3_21_6_3_10_2" class="Section_Title">Limitations &amp; Constraints of Write-Behind</div><div id="ww3_12_3_21_6_3_12_2" class="Section_Title">Transaction Boundaries</div><div id="ww3_12_3_21_6_3_12_4" class="Body">If the cache participates in a JTA transaction, which means it is an XAResource, then the cache can be made consistent with the database. A write to the database, and a commit or rollback, happens with the transaction boundary. In write-behind, the write to the resource happens after the write to the cache. The transaction boundary is the write to the outstanding queue, not the write behind. In write-through mode, commit can get called and both the cache and the underlying resource can get committed at once. Because the database is being written to outside of the transaction, there is always a risk that a failure on the eventual write will occur. While this can be mitigated with retry counts and delays, compensating actions may be required.</div><div id="ww3_12_3_21_6_3_14_2" class="Section_Title">Time Delay</div><div id="ww3_12_3_21_6_3_14_4" class="Body">The obvious implication of asynchronous writes is that there is a delay between when the cache is updated and when the database is updated. This introduces an inconsistency between the cache and the database, where the cache holds the correct value and the database will be eventually consistent with the cache.</div><div id="ww3_12_3_21_6_3_14_6" class="Body">The data passed into the CacheWriter methods is a snapshot of the cache entry at the time of the write to operation. A read against the database will result in incorrect data being loaded.</div><div id="ww3_12_3_21_6_3_16_2" class="Section_Title">Applications Tolerant of Inconsistency</div><div id="ww3_12_3_21_6_3_16_4" class="Body">The application must be tolerant of inconsistent data. The following examples illustrate this requirement:</div><div id="ww3_12_3_21_6_3_16_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>The database is logging transactions and only appends are done.</div><div id="ww3_12_3_21_6_3_16_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Reading is done by a part of the application that does not write, so there is no way that data can be corrupted. The application is tolerant of delays. For example, a news application where the reader displays the articles that are written.</div><div id="ww3_12_3_21_6_3_16_8" class="Body">Note if other applications are writing to the database, then a cache can often be inconsistent with the database.</div><div id="ww3_12_3_21_6_3_18_2" class="Section_Title">Time Synchronization Across Nodes</div><div id="ww3_12_3_21_6_3_18_4" class="Body">Ideally node times should be synchronized. The write-behind queue is generally written to the underlying resource in timestamp order, based on the timestamp of the cache operation, although there is no guaranteed ordering. The ordering will be more consistent if all nodes are using the same time. This can easily be achieved by configuring your system clock to synchronize with a time authority using Network Time Protocol.</div><div id="ww3_12_3_21_6_3_20_2" class="Section_Title">No Ordering Guarantees</div><div id="ww3_12_3_21_6_3_20_4" class="Body">The items on the write-behind queue are generally in order, but this isn't guaranteed. In certain situations, the items can be processed out of order. Additionally, when batching is used, write and delete collections are aggregated separately and can be processed inside the CacheWriter in a different order than the order that was used by the queue. Your application must be tolerant of item reordering or you need to compensate for this in your implementation of the CacheWriter. Possible examples are:</div><div id="ww3_12_3_21_6_3_20_6_2_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Working with versioning in the cache elements.</div><div id="ww3_12_3_21_6_3_20_6_2_5" class="List_1_Continued">You may have to explicitly version elements. Auto-versioning is off by default and is effective only for unclustered MemoryStore caches. Distributed caches or caches that use off-heap or disk stores cannot use auto-versioning. To enable auto-versioning, set the system property <span class="codeph">net.sf.ehcache.element.version.auto</span> (it is false by default). Note that if this property is turned on for one of the ineligible cache types, auto-versioning will silently fail.</div><div id="ww3_12_3_21_6_3_20_6_4_3" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Verifications with the underlying resource to check if the scheduled write-behind operation is still relevant.</div><div id="ww3_12_3_21_6_3_22_2" class="Section_Title">Introductory Video</div><div id="ww3_12_3_21_6_3_22_4" class="Body">Alex Snaps the primary author of Write Behind, presents an <span class="external"><a href="http://vimeo.com/21193026" target="external_window">introductory video</a></span> on Write Behind.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2015</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>