<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Built-In Sizing Computation and Enforcement</title><link rel="Prev" href="co-size_pinning_and_size_limits.html" title="Previous"><link rel="Next" href="co-size_eviction_on_cache_manager_level_store.html" title="Next"><link rel="StyleSheet" href="css/ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/Ehcache_Documentation_Set/co-size_builtin_resizing_computations.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN23g_002fZJDNS9IbiSPB06dZqg" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-size_builtin_resizing_computations.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.016.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-title_ehcache_configuration_guide.html#wwconnect_header">Ehcache Configuration Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-size_sizing_storage_tiers.html#wwconnect_header">Sizing Storage Tiers</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Built-In Sizing Computation and Enforcement</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_12_5_11_14_1" class="Heading_3">Built-In Sizing Computation and Enforcement</div><div id="ww3_12_5_11_14_3_2" class="Body">Internal <span class="ph">Ehcache</span> mechanisms track data-element sizes and enforce the limits set by CacheManager sizing pools.</div><div id="ww3_12_5_11_14_3_4_2" class="Section_Title">Sizing of Elements</div><div id="ww3_12_5_11_14_3_4_4" class="Body">Elements put in a memory-limited cache will have their memory sizes measured. The entire Element instance added to the cache is measured, including key and value, as well as the memory footprint of adding that instance to internal data structures. Key and value are measured as object graphs – each reference is followed and the object reference also measured. This goes on recursively.</div><div id="ww3_12_5_11_14_3_4_6" class="Body">Shared references will be measured by each class that references it. This will result in an overstatement. Shared references should therefore be ignored.</div><div id="ww3_12_5_11_14_3_6_2" class="Section_Title">Ignoring for Size Calculations</div><div id="ww3_12_5_11_14_3_6_4" class="Body">For the purposes of measurement, references can be ignored using the <span class="codeph">@IgnoreSizeOf</span> annotation. The annotation may be declared at the class level, on a field, or on a package. You can also specify a file containing the fully qualified names of classes, fields, and packages to be ignored.</div><div id="ww3_12_5_11_14_3_6_6" class="Body">This annotation is not inherited, and must be added to any subclasses that should also be excluded from sizing.</div><div id="ww3_12_5_11_14_3_6_8" class="Body">The following example shows how to ignore the <span class="codeph">Dog</span> class.</div><div id="ww3_12_5_11_14_3_6_10" class="Preformatted">@IgnoreSizeOf <br>public class Dog { <br>  private Gender gender; <br>  private String name; <br>}</div><div id="ww3_12_5_11_14_3_6_12" class="Body">The following example shows how to ignore the <span class="codeph">sharedInstance</span> field.</div><div id="ww3_12_5_11_14_3_6_14" class="Preformatted">public class MyCacheEntry { <br>  @IgnoreSizeOf <br>  private final SharedClass sharedInstance; <br>    ... <br>}</div><div id="ww3_12_5_11_14_3_6_16" class="Body">Packages may be also ignored if you add the @IgnoreSizeOf annotation to appropriate package-info.java of the desired package. Here is a sample package-info.java for and in the com.pany.ignore package:</div><div id="ww3_12_5_11_14_3_6_18" class="Preformatted">@IgnoreSizeOf <br>package com.pany.ignore; <br>import net.sf.ehcache.pool.sizeof.filter.IgnoreSizeOf;</div><div id="ww3_12_5_11_14_3_6_20" class="Body">Alternatively, you may declare ignored classes and fields in a file and specify a <span class="parmname">net.sf.ehcache.sizeof.filter</span> system property to point to that file.</div><div id="ww3_12_5_11_14_3_6_22" class="Preformatted"># That field references a common graph between all cached entries <br>com.pany.domain.cache.MyCacheEntry.sharedInstance <br># This will ignore all instances of that type <br>com.pany.domain.SharedState <br># This ignores a package <br>com.pany.example</div><div id="ww3_12_5_11_14_3_6_24" class="Body">Note that these measurements and configurations apply only to on-heap storage. Once Elements are moved to disk, they are serialized as byte arrays. The serialized size is then used as the basis for measurement.</div><div id="ww3_12_5_11_14_3_8_2" class="Section_Title">Configuration for Limiting the Traversed Object Graph</div><div id="ww3_12_5_11_14_3_8_4" class="Body">As noted above, sizing caches involves traversing object graphs, a process that can be limited with annotations. This process can also be controlled at both the CacheManager and cache levels.</div><div id="ww3_12_5_11_14_3_10_2" class="Section_Title">Size-Of Limitation at the CacheManager Level</div><div id="ww3_12_5_11_14_3_10_4" class="Body">Control how deep the size-of engine can go when sizing on-heap elements by adding the following element at the CacheManager level:</div><div id="ww3_12_5_11_14_3_10_6" class="Preformatted">&lt;sizeOfPolicy maxDepth="100" maxDepthExceededBehavior="abort"/&gt;</div><div id="ww3_12_5_11_14_3_10_8" class="Body">This element has the following attributes</div><div id="ww3_12_5_11_14_3_10_10_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="parmname">maxDepth</span> – Controls how many linked objects can be visited before the size-of engine takes any action. This attribute is required.</div><div id="ww3_12_5_11_14_3_10_10_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="parmname">maxDepthExceededBehavior</span> – Specifies what happens when the max depth is exceeded while sizing an object graph:</div><div id="ww3_12_5_11_14_3_10_10_4_5_2" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>"continue" – (DEFAULT) Forces the size-of engine to log a warning and continue the sizing operation. If this attribute is not specified, "continue" is the behavior used.</div><div id="ww3_12_5_11_14_3_10_10_4_5_4" class="List_2"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>"abort" – Forces the SizeOf engine to abort the sizing, log a warning, and mark the cache as not correctly tracking memory usage. With this setting, <span class="codeph">Ehcache.hasAbortedSizeOf()</span> returns true.</div><div id="ww3_12_5_11_14_3_10_12" class="Body">The SizeOf policy can be configured at the CacheManager level (directly under <span class="codeph">&lt;ehcache&gt;</span>) and at the cache level (under <span class="codeph">&lt;cache&gt;</span> or <span class="codeph">&lt;defaultCache&gt;</span>). The cache policy always overrides the CacheManager if both are set.</div><div id="ww3_12_5_11_14_3_12_2" class="Section_Title">Size-Of Limitation at the Cache level</div><div id="ww3_12_5_11_14_3_12_4" class="Body">Use the <span class="parmname">&lt;sizeOfPolicy&gt;</span> as a sub-element in any <span class="codeph">&lt;cache&gt;</span> block to control how deep the size-of engine can go when sizing on-heap elements belonging to the target cache. This cache-level setting overrides the CacheManager size-of setting.</div><div id="ww3_12_5_11_14_3_14_2" class="Section_Title">Debugging of Size-Of Related Errors</div><div id="ww3_12_5_11_14_3_14_4" class="Body">If warnings or errors appear that seem related to size-of measurement (usually caused by the size-of engine walking the graph), generate more log information on sizing activities:</div><div id="ww3_12_5_11_14_3_14_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Set the <span class="codeph">net.sf.ehcache.sizeof.verboseDebugLogging</span> system property to true.</div><div id="ww3_12_5_11_14_3_14_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Enable debug logs on <span class="codeph">net.sf.ehcache.pool.sizeof</span> in your chosen implementation of SLF4J.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2010</span><span>-2015</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>