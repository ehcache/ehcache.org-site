<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Tomcat Issues and Best Practices</title><link rel="Prev" href="co-tcat_about_using_ehcache_with_tomcat.html" title="Previous"><link rel="Next" href="to-jdbc_using_ehcache_with_jdbc.html" title="Next"><link rel="StyleSheet" href="css/ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/social.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript">
    'use strict';

    var redirect_url, page_hash;

    if (window === window.top) {
        // Redirect
        //
        redirect_url = "../index.html#page/Ehcache_Documentation_Set/co-tcat_tomcat_issues_and_practices.html";
        if (window.document.location.hash.length > 1) {
            // Sanitize and append it
            //
            page_hash = window.document.location.hash.substring(1);
            page_hash = page_hash.replace(/[\\><:;"]|%5C|%3C|%3E|%3A|%3B|%22/gi, '');
            redirect_url += '#' + page_hash;
        }
        window.document.location.replace(redirect_url);
    }
</script><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pynYj_002fli5tVFkcvLUWezyDw" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-tcat_tomcat_issues_and_practices.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.187.html#wwconnect_header">Related Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-title_ehcache_integrations.html#wwconnect_header">Integrations</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-tcat_using_ehcache_with_tomcat.html#wwconnect_header">Using Ehcache with Tomcat</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Tomcat Issues and Best Practices</span></div><div class="ww_skin_page_toolbar"></div></header><div id="ww3_15_7_17_8_1" class="Heading_3">Tomcat Issues and Best Practices</div><div id="ww3_15_7_17_8_2_2_2" class="Section_Title">Problem rejoining a cluster after a reload</div><div id="ww3_15_7_17_8_2_2_4" class="Body">If I restart/reload a web application in Tomcat that has a CacheManager that is part of a cluster, the CacheManager is unable to rejoin the cluster. If I set logging for <span class="codeph">net.sf.ehcache.distribution</span> to FINE I see the following exception:</div><div id="ww3_15_7_17_8_2_2_6" class="Preformatted">FINE: Unable to lookup remote cache peer for .... <br>Removing from peer list. <br>Cause was: error unmarshalling return; <br>nested exception is: java.io.EOFException.</div><div id="ww3_15_7_17_8_2_2_8" class="Body">The Tomcat and RMI class loaders do not get along that well. Move ehcache.jar to <span class="codeph">$TOMCAT_HOME/common/lib</span>. This fixes the problem. This issue happens with anything that uses RMI, not just Ehcache.</div><div id="ww3_15_7_17_8_2_4_2" class="Section_Title">Class-loader memory leak</div><div id="ww3_15_7_17_8_2_4_4" class="Body">In development, there appears to be class loader memory leak as I continually redeploy my web application. There are lots of causes of memory leaks on redeploy. Moving Ehcache out of the WAR and into <span class="codeph">$TOMCAT/common/lib fixes this leak</span>.</div><div id="ww3_15_7_17_8_2_6_2" class="Section_Title">RMI CacheException - problem starting listener for RMICachePeer</div><div id="ww3_15_7_17_8_2_6_4" class="Body">I get the following error:</div><div id="ww3_15_7_17_8_2_6_6" class="Preformatted">net.sf.ehcache.CacheException: Problem starting listener for RMICachePeer ... <br>java.rmi.UnmarshalException: error unmarshalling arguments; <br>nested exception is: java.net.MalformedURLException: no protocol: Files/Apache.</div><div id="ww3_15_7_17_8_2_6_8" class="Body">What is going on? This issue occurs to any RMI listener started on Tomcat whenever Tomcat has spaces in its installation path. It can be worked around in Tomcat. The workaround is to remove the spaces in your Tomcat installation path.</div><div id="ww3_15_7_17_8_2_8_2" class="Section_Title">Multiple host entries in Tomcat's server.xml stops replication from occurring</div><div id="ww3_15_7_17_8_2_8_4" class="Body">The presence of multiple &lt;Host&gt; entries in Tomcat's server.xml prevents replication from occurring. The issue is with adding multiple hosts on a single Tomcat connector. If one of the hosts is localhost and another starts with v, then the caching between machines when hitting localhost stops working correctly. The workaround is to use a single &lt;Host&gt; entry or to make sure they don't start with "v". Why this issue occurs is presently unknown, but it is Tomcat-specific.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2010</span><span>-2015</span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr></div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/ehcache_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
          |&nbsp;&nbsp;
        <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></body></html>