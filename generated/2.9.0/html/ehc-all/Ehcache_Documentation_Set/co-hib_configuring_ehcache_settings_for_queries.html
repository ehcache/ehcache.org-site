<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Ehcache Settings for Queries</title><link rel="Prev" href="co-hib_configuring_ehcache_settings_for_collections.html" title="Previous"><link rel="Next" href="co-hib_the_demo_app.html" title="Next"><link rel="StyleSheet" href="css/_ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN51jsdtuPoofkoCc4NtyEBw" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-hib_configuring_ehcache_settings_for_queries.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.188.html#wwconnect_header">Related Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.265.html#wwconnect_header">Integrations</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-hib_using_ehcache_with_hibernate.html#wwconnect_header">Using Ehcache with Hibernate</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/co-hib_configuring_ehcache_settings.html#wwconnect_header">Configuring ehcache.xml Settings</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Ehcache Settings for Queries</span></div><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><!--        <a wwpage:condition="print-enabled" class="ww_behavior_print ww_skin ww_skin_print" title="Print" wwpage:attribute-title="navigation-print-title" href="#">&#160;</a>  --></div></header><div id="ww3_12_6_5_17_10_1" class="Heading_4">Ehcache Settings for Queries</div><div id="ww3_12_6_5_17_10_2_2" class="Body">Hibernate allows the caching of query results.</div><div id="ww3_12_6_5_17_10_2_4_3" class="Section_Title">StandardQueryCache</div><div id="ww3_12_6_5_17_10_2_4_5" class="Body">This cache is used if you use a query cache without setting a name. A typical ehcache.xml configuration is:</div><div id="ww3_12_6_5_17_10_2_4_7" class="Preformatted">&lt;cache <br>name="org.hibernate.cache.StandardQueryCache" <br>maxEntriesLocalHeap="5" <br>eternal="false" <br>timeToLiveSeconds="120" <br>&lt;persistence strategy="localTempSwap"/&gt; <br>/&gt;</div><div id="ww3_12_6_5_17_10_2_6_3" class="Section_Title">UpdateTimestampsCache</div><div id="ww3_12_6_5_17_10_2_6_5" class="Body">Tracks the timestamps of the most recent updates to particular tables. It is important that the cache timeout of the underlying cache implementation be set to a higher value than the timeouts of any of the query caches. In fact, it is recommend that the underlying cache not be configured for expiry at all. A typical ehcache.xml configuration is:</div><div id="ww3_12_6_5_17_10_2_6_7" class="Preformatted">&lt;cache <br>name="org.hibernate.cache.UpdateTimestampsCache" <br>maxEntriesLocalHeap="5000" <br>eternal="true" <br>&lt;persistence strategy="localTempSwap"/&gt; <br>/&gt;</div><div id="ww3_12_6_5_17_10_2_8_3" class="Section_Title">Named Query Caches</div><div id="ww3_12_6_5_17_10_2_8_5" class="Body">In addition, a QueryCache can be given a specific name in Hibernate using Query.setCacheRegion(String name). The name of the cache in ehcache.xml is then the name given in that method. The name can be whatever you want, but by convention you should use “query.” followed by a descriptive name. For example:</div><div id="ww3_12_6_5_17_10_2_8_7" class="Preformatted">&lt;cache name="query.AdministrativeAreasPerCountry" <br>maxEntriesLocalHeap="5" <br>eternal="false" <br>timeToLiveSeconds="86400" <br>&lt;persistence strategy="localTempSwap"/&gt; <br>/&gt;</div><div id="ww3_12_6_5_17_10_2_10_3" class="Section_Title">Using Query Caches</div><div id="ww3_12_6_5_17_10_2_10_5" class="Body">Let's say you have a common query running against the Country Domain. Here is the code to use a query cache with it:</div><div id="ww3_12_6_5_17_10_2_10_7" class="Preformatted">public List getStreetTypes(final Country country) throws HibernateException { <br>final Session session = createSession(); <br>try { <br>   final Query query = session.createQuery( <br>    "select st.id, st.name" <br>   + " from StreetType st " <br>   + " where st.country.id = :countryId " <br>   + " order by st.sortOrder desc, st.name"); <br>   query.setLong("countryId", country.getId().longValue()); <br>   query.setCacheable(true); <br>   query.setCacheRegion("query.StreetTypes"); <br>   return query.list(); <br>} finally { <br>   session.close(); <br>} <br>}</div><div id="ww3_12_6_5_17_10_2_10_9" class="Body">The <span class="codeph">query.setCacheable(true)</span> line caches the query. The <span class="codeph">query.setCacheRegion("query.StreetTypes")</span> line sets the name of the Query Cache. Alex Miller has a good article on the query cache <span class="external"><a href="http://tech.puredanger.com/2009/07/10/hibernate-query-cache/" target="external_window">here</a></span>.</div><div id="ww3_12_6_5_17_10_2_12_3" class="Section_Title">Hibernate CacheConcurrencyStrategy for Queries</div><div id="ww3_12_6_5_17_10_2_12_5" class="Body">None of the read-write, nonstrict-read-write and read-only policies apply to Domain Objects. Cache policies are not configurable for query cache. They act like a non-locking read only cache.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2014</span><span> </span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/product_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
             |&nbsp;&nbsp;
         <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></div></body></html>