<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Configuring Disk Store</title><link rel="Prev" href="co-tiers_configuring_memory_store.html" title="Previous"><link rel="Next" href="to-size_sizing_storage_tiers.html" title="Next"><link rel="StyleSheet" href="css/_ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/_ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pNF80oEQbbGNT9Prlsx4hyA" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-tiers_configuring_disk_store.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.017.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/_ehcache_all.1.121.html#wwconnect_header">Ehcache Configuration Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-tiers_configuring_storage_tiers.html#wwconnect_header">Configuring Storage Tiers</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Configuring Disk Store</span></div><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><!--        <a wwpage:condition="print-enabled" class="ww_behavior_print ww_skin ww_skin_print" title="Print" wwpage:attribute-title="navigation-print-title" href="#">&#160;</a>  --></div></header><div id="ww3_9_4_7_10_1" class="Heading_3">Configuring Disk Store</div><div id="ww3_9_4_7_10_3_2" class="Body">The disk store provides a thread-safe disk-spooling facility that can be used for either additional storage or persisting data through system restarts.</div><div id="ww3_9_4_7_10_3_4" class="Body">This section describes local disk usage. <span class="ph"> You can find additional information about configuring the disk store in </span><span class="heading-page"><a href="../Ehcache_Documentation_Set/to-persist_configuring_persistance_and_restart.html#wwconnect_header" title="Configuring Restartability and Persistence">Configuring Restartability and Persistence</a></span><span class="ph">. </span></div><div id="ww3_9_4_7_10_3_6_3" class="Section_Title">Serialization</div><div id="ww3_9_4_7_10_3_6_5" class="Body">Only data that is Serializable can be placed in the disk store. Writes to and from the disk use ObjectInputStream and the Java serialization mechanism. Any non-serializable data overflowing to the disk store is removed and a NotSerializableException is thrown.</div><div id="ww3_9_4_7_10_3_6_7" class="Body">Serialization speed is affected by the size of the objects being serialized and their type. It has been found that:</div><div id="ww3_9_4_7_10_3_6_9_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>The serialization time for a Java object consisting of a large Map of String arrays was 126ms, where the serialized size was 349,225 bytes.</div><div id="ww3_9_4_7_10_3_6_9_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>The serialization time for a byte[] was 7ms, where the serialized size was 310,232 bytes.</div><div id="ww3_9_4_7_10_3_6_11" class="Body">Byte arrays are 20 times faster to serialize, making them a better choice for increasing disk-store performance.</div><div id="ww3_9_4_7_10_3_8_3" class="Section_Title">Configuring the Disk Store</div><div id="ww3_9_4_7_10_3_8_5" class="Body">Disk stores are configured on a per CacheManager basis. If one or more caches requires a disk store but none is configured, a default directory is used and a warning message is logged to encourage explicit configuration of the disk store path.</div><div id="ww3_9_4_7_10_3_8_7" class="Body">Configuring a disk store is optional. If all caches use only memory, then there is no need to configure a disk store. This simplifies configuration, and uses fewer threads. This also makes it unnecessary to configure multiple disk store paths when multiple CacheManagers are being used.</div><div id="ww3_9_4_7_10_3_8_9" class="Body">Two disk store options are available:</div><div id="ww3_9_4_7_10_3_8_11_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Temporary store (<span class="parmname">localTempSwap</span>)</div><div id="ww3_9_4_7_10_3_8_11_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span>Persistent store (<span class="parmname">localRestartable</span>)</div><div id="ww3_9_4_7_10_3_10_3" class="Section_Title">localTempSwap</div><div id="ww3_9_4_7_10_3_10_5" class="Body">The <span class="parmname">localTempSwap</span> persistence strategy allows the memory store to overflow to disk when it becomes full. This option makes the disk a temporary store because overflow data does not survive restarts or failures. When the node is restarted, any existing data on disk is cleared because it is not designed to be reloaded.</div><div id="ww3_9_4_7_10_3_10_7" class="Body">If the disk store path is not specified, a default path is used, and the default will be auto-resolved in the case of a conflict with another CacheManager.</div><div id="ww3_9_4_7_10_3_10_9" class="Body">The localTempSwap disk store creates a data file for each cache on startup called “<span class="varname">&lt;cache_name&gt;</span>.data".</div><div id="ww3_9_4_7_10_3_12_3" class="Section_Title">localRestartable</div><div id="ww3_9_4_7_10_3_12_5" class="Body">This option implements a restartable store for all in-memory data. After any restart, the data set is automatically reloaded from disk to the in-memory stores.</div><div id="ww3_9_4_7_10_3_12_7" class="Body">The path to the directory where any required disk files will be created is configured with the <span class="codeph">&lt;diskStore&gt;</span> sub-element of the Ehcache configuration. In order to use the restartable store, a unique and explicitly specified path is required.</div><div id="ww3_9_4_7_10_3_14_3" class="Section_Title">The diskStore Configuration Element</div><div id="ww3_9_4_7_10_3_14_5" class="Body">Files are created in the directory specified by the <span class="codeph">&lt;diskStore&gt;</span> configuration element. The <span class="codeph">&lt;diskStore&gt;</span> element has one attribute called <span class="codeph">path</span>.</div><div id="ww3_9_4_7_10_3_14_7" class="Preformatted">&lt;diskStore path="/path/to/store/data"/&gt;</div><div id="ww3_9_4_7_10_3_14_9" class="Body">Legal values for the path attribute are legal file system paths. For example, for Unix:</div><div id="ww3_9_4_7_10_3_14_11" class="Preformatted">/home/application/cache</div><div id="ww3_9_4_7_10_3_14_13" class="Body">The following system properties are also legal, in which case they are translated:</div><div id="ww3_9_4_7_10_3_14_15_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="parmname">user.home</span> - User's home directory</div><div id="ww3_9_4_7_10_3_14_15_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="parmname">user.dir</span>- User's current working directory</div><div id="ww3_9_4_7_10_3_14_15_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="parmname">java.io.tmpdir</span> - Default temp file path</div><div id="ww3_9_4_7_10_3_14_15_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="parmname">ehcache.disk.store.dir</span>- A system property you would normally specify on the command line—for example, <span class="codeph">java -Dehcache.disk.store.dir=/u01/myapp/diskdir</span>.</div><div id="ww3_9_4_7_10_3_14_17" class="Body">Subdirectories can be specified below the system property, for example:</div><div id="ww3_9_4_7_10_3_14_19" class="Preformatted">user.dir/one</div><div id="ww3_9_4_7_10_3_14_21" class="Body">To programmatically set a disk store path:</div><div id="ww3_9_4_7_10_3_14_23" class="Preformatted">DiskStoreConfiguration diskStoreConfiguration = new DiskStoreConfiguration(); <br>diskStoreConfiguration.setPath("/my/path/dir"); <br>// Already created a configuration object ... <br>configuration.addDiskStore(diskStoreConfiguration); <br>CacheManager mgr = new CacheManager(configuration);</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_9_4_7_10_3_14_25_1_3_1_1_2" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_9_4_7_10_3_14_25_1_3_1_2" class="Table_Cell">A CacheManager's disk store path cannot be changed once it is set in configuration. If the disk store path is changed, the CacheManager must be recycled for the new path to take effect.</div></td></tr></table></div><div id="ww3_9_4_7_10_3_16_3" class="Section_Title">Disk Store Expiry and Eviction</div><div id="ww3_9_4_7_10_3_16_5" class="Body">Expired elements are eventually evicted to free up disk space. The element is also removed from the in-memory index of elements.</div><div id="ww3_9_4_7_10_3_16_7" class="Body">One thread per cache is used to remove expired elements. The optional attribute <span class="codeph">diskExpiryThreadIntervalSeconds</span> sets the interval between runs of the expiry thread.</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_9_4_7_10_3_16_9_1_3_1_1_2" class="important"><span style="font-weight: bold">Important:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_9_4_7_10_3_16_9_1_3_1_2" class="Table_Cell">Setting <span class="codeph">diskExpiryThreadIntervalSeconds</span> to a low value can cause excessive disk-store locking and high CPU utilization. The default value is 120 seconds.</div></td></tr></table></div><div id="ww3_9_4_7_10_3_16_11" class="Body">If a cache's disk store has a limited size, Elements will be evicted from the disk store when it exceeds this limit. The LFU algorithm is used for these evictions. It is not configurable or changeable.</div><div class="ww_skin_page_overflow"><table class="note1" summary=""><tr><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_9_4_7_10_3_16_13_1_3_1_1_2" class="Note"><span style="font-weight: bold">Note:  </span>&nbsp;</div></td><td class="Table_Cell" style="padding-right: 6px; vertical-align: top"><div id="ww3_9_4_7_10_3_16_13_1_3_1_2" class="Table_Cell">With the <span class="parmname">localTempSwap</span> strategy, you can use <span class="codeph">maxEntriesLocalDisk</span> or <span class="codeph">maxBytesLocalDisk</span> at either the Cache or CacheManager level to control the size of the disk tier.</div></td></tr></table></div><div id="ww3_9_4_7_10_3_18_3" class="Section_Title">Turning off Disk Stores</div><div id="ww3_9_4_7_10_3_18_5" class="Body">To turn off disk store path creation, comment out the <span class="codeph">diskStore</span> element in ehcache.xml.</div><div id="ww3_9_4_7_10_3_18_7" class="Body">The default Ehcache configuration, ehcache-failsafe.xml, uses a disk store. To avoid use of a disk store, specify a custom ehcache.xml with the <span class="codeph">diskStore</span> element commented out.</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright © <span>2014</span><span> </span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/product_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
             |&nbsp;&nbsp;
         <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></div></body></html>