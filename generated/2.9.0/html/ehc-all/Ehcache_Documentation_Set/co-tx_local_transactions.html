<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Working with Local Transactions</title><link rel="Prev" href="co-tx_transaction_managers.html" title="Previous"><link rel="Next" href="co-tx_performance_considerations.html" title="Next"><link rel="StyleSheet" href="css/ehcache_all.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/ehcache_all_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN0Brk7khXUbsUzSyiGSBu5w" class="ww_skin_page_body" onload="Page.OnLoad('../index.html#page/Ehcache_Documentation_Set/co-tx_local_transactions.html');"><header id="wwconnect_header"><div class="ww_skin_breadcrumbs"><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/ehcache_all.1.017.html#wwconnect_header">Product Documentation</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/ehcache_all.1.018.html#wwconnect_header">Ehcache Developer Guide</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_parent"><a href="../Ehcache_Documentation_Set/to-tx_transaction_support.html#wwconnect_header">Transaction Support</a></span><span class="ww_skin_breadcrumbs_divider"> : </span><span class="ww_skin_breadcrumbs_current">Working with Local Transactions</span></div><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><!--        <a wwpage:condition="print-enabled" class="ww_behavior_print ww_skin ww_skin_print" title="Print" wwpage:attribute-title="navigation-print-title" href="#">&#160;</a>  --></div></header><div id="ww3_9_3_17_20_1" class="Heading_3">Working with Local Transactions</div><div id="ww3_9_3_17_20_3_2" class="Body">Local Transactions allow single-phase commit across multiple cache operations, across one or more caches, and in the same CacheManager.This lets you apply multiple changes to a CacheManager all in your own transaction. If you also want to apply changes to other resources, such as a database, open a transaction to them and manually handle commit and rollback to ensure consistency.</div><div id="ww3_9_3_17_20_3_4" class="Body">Local transactions are not controlled by a transaction manager. Instead there is an explicit API where a reference is obtained to a TransactionController for the CacheManager using cacheManager.getTransactionController() and the steps in the transaction are called explicitly. The steps in a local transaction are:</div><div id="ww3_9_3_17_20_3_6_2" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">transactionController.begin()</span> - This marks the beginning of the local transaction on the current thread. The changes are not visible to other threads or to other transactions.</div><div id="ww3_9_3_17_20_3_6_4" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">transactionController.commit()</span> - Commits work done in the current transaction on the calling thread.</div><div id="ww3_9_3_17_20_3_6_6" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">transactionController.rollback()</span> - Rolls back work done in the current transaction on the calling thread. The changes done since begin are not applied to the cache. These steps should be placed in a try-catch block which catches TransactionException. If any exceptions are thrown, rollback() should be called. Local Transactions has its own exceptions that can be thrown, which are all subclasses of CacheException. They are:</div><div id="ww3_9_3_17_20_3_6_8" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">TransactionException</span> - a general exception</div><div id="ww3_9_3_17_20_3_6_10" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">TransactionInterruptedException</span> - if Thread.interrupt() was called while the cache was processing a transaction.</div><div id="ww3_9_3_17_20_3_6_12" class="List_1"><span class="WebWorks_Number" style="width: 18pt"><span><img src="bullet.gif" alt="*" border="0" width="10" height="10"></span></span><span class="codeph">TransactionTimeoutException</span> - if a cache operation or commit is called after the transaction timeout has elapsed.</div><div id="ww3_9_3_17_20_3_8_3" class="Section_Title">Introductory Video</div><div id="ww3_9_3_17_20_3_8_5" class="Body">Ludovic Orban, the primary author of Local Transactions, presents an <span class="external"><a href="http://vimeo.com/21299785" target="external_window">introductory video</a></span> on Local Transactions.</div><div id="ww3_9_3_17_20_3_10_3" class="Section_Title">Configuration</div><div id="ww3_9_3_17_20_3_10_5" class="Body">Local transactions are configured as follows:</div><div id="ww3_9_3_17_20_3_10_7" class="Preformatted">&lt;cache name="sampleCache" <br>   ... <br>   transactionalMode="local" <br> &lt;/cache&gt;</div><div id="ww3_9_3_17_20_3_12_3" class="Section_Title">Isolation Level</div><div id="ww3_9_3_17_20_3_12_5" class="Body">As with the other transaction modes, the isolation level is READ_COMMITTED.</div><div id="ww3_9_3_17_20_3_14_3" class="Section_Title">Transaction Timeouts</div><div id="ww3_9_3_17_20_3_14_5" class="Body">If a transaction cannot complete within the timeout period, a TransactionTimeoutException is thrown. To return the cache to a consistent state, call transactionController.rollback(). Because TransactionController is at the level of the CacheManager, a default timeout can be set which applies to all transactions across all caches in a CacheManager. The default is 15 seconds. To change the defaultTimeout:</div><div id="ww3_9_3_17_20_3_14_7" class="Preformatted">transactionController.setDefaultTransactionTimeout(int defaultTransactionTimeoutSeconds)</div><div id="ww3_9_3_17_20_3_14_9" class="Body">The countdown starts when begin() is called. You might have another local transaction on a JDBC connection and you might be making multiple changes. If you think it might take longer than 15 seconds for an individual transaction, you can override the default when you begin the transaction with:</div><div id="ww3_9_3_17_20_3_14_11" class="Preformatted">transactionController.begin(int transactionTimeoutSeconds) {</div><div id="ww3_9_3_17_20_3_16_3" class="Section_Title">Sample Code</div><div id="ww3_9_3_17_20_3_16_5" class="Body">The following example shows a transaction that performs multiple operations across two caches.</div><div id="ww3_9_3_17_20_3_16_7" class="Preformatted">CacheManager cacheManager = CacheManager.getInstance(); <br>try { <br>   cacheManager.getTransactionController().begin(); <br>    cache1.put(new Element(1, "one")); <br>   cache2.put(new Element(2, "two")); <br>   cache1.remove(4); <br>    cacheManager.getTransactionController().commit(); <br>} catch (CacheException e) { <br>   cacheManager.getTransactionController().rollback() <br>}</div><footer><!-- Related Topics --><!--                --><!-- Back to Top --><!--             --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br></footer><div><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 11px; margin-top: 20px; margin-bottom: 20px;"><span class="xref"><a href="http://documentation.softwareag.com/legal/" target="external_window">Copyright Â© <span>2014</span><span> </span><span></span><span></span> Software AG, Darmstadt, Germany</a></span>.</div><hr><div style="font-family: Arial, Verdana, Helvetica, Sans-Serif; font-size: 13px; font-weight: bold; margin-top: 20px;"><span><img style="vertical-align:middle" src="../connect/product_online.png" alt="Product Logo"><!--	     <a href="https://empower.softwareag.com/ContactSupport/default.asp" target="_blank" >Contact&#160;Support</a> --><!--         &#160;&#160;|&#160;&#160;  --><!--         <a href="http://www.softwareag.com/corporate/community/default.asp" target="_blank" >Community</a>  --><!--         &#160;&#160;  -->
             |&nbsp;&nbsp;
         <a href="mailto://documentation@softwareag.com" target="_blank">Feedback&nbsp;&nbsp;</a></span></div></div></body></html>